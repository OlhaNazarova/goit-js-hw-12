{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport axios from 'axios';\n\nlet page;\nlet searchText = '';\nlet totalPages;\nlet gallery = null;\n\nconst refs = {\n  form: document.querySelector('.form'),\n  textInput: document.querySelector('#query'),\n  searchBtn: document.querySelector('.search-button'),\n  galleryList: document.querySelector('.gallery-list'),\n  searchLoader: document.querySelector('.search-loader'),\n  moreLoader: document.querySelector('.more-loader'),\n  moreBtn: document.querySelector('.more-button'),\n  moreWrapper: document.querySelector('.more-wrapper'),\n};\n\nconst simplelightboxOptions = {\n  captions: true,\n  captionDelay: 250,\n  captionSelector: 'img',\n  captionType: 'attr',\n  captionsData: 'alt',\n  captionPosition: 'bottom',\n  captionClass: '',\n  captionHTML: true,\n  spinner: true,\n};\n\nrefs.form.addEventListener('submit', onSearch);\n\nasync function onSearch(e) {\n  e.preventDefault();\n  page = 1;\n  totalPages = 0;\n  loaderShow(refs.searchLoader);\n  searchText = e.currentTarget.elements.query.value;\n\n  try {\n    const data = await fetchPhotos(searchText);\n    createGallery(data);\n  } catch (err) {\n    console.log(err);\n  }\n  refs.form.reset();\n}\nasync function fetchPhotos(searchText) {\n  const searchParams = new URLSearchParams({\n    key: '42031589-0742425241f8784341d5a922f',\n    q: searchText,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    per_page: 15,\n    page,\n  });\n  const response = await axios.get(`https://pixabay.com/api/?${searchParams}`);\n  const data = response.data;\n  totalPages = Math.ceil(data.total / 15);\n  console.log(data.total);\n  console.log('total pages: ', totalPages);\n  console.log('current page', page);\n  if (page < totalPages) {\n    moreBtnShow();\n  }\n  return data;\n}\n\nfunction renderGalleryMarkup(photoList) {\n  return photoList\n    .map(photo => {\n      return `\n      <li class=\"gallery-item\">\n        <a class=\"gallery-link\" href=\"${photo.largeImageURL}\">\n          <img\n            class=\"gallery-image\"\n            src=\"${photo.webformatURL}\"\n            data-source=\"${photo.largeImageURL}\"\n            alt=\"${photo.tags}\"\n          />\n        </a>\n      </li>\n      `;\n    })\n    .join('\\n');\n}\n\nfunction loaderHide(loader) {\n  loader.classList.add('hidden');\n}\n\nfunction loaderShow(loader) {\n  loader.classList.remove('hidden');\n}\n\nfunction moreBtnHide() {\n  refs.moreWrapper.classList.add('hidden');\n}\n\nfunction moreBtnShow() {\n  refs.moreWrapper.classList.remove('hidden');\n}\n\nfunction createGallery(data) {\n  if (data.total === 0) {\n    iziToast.error({\n      message: `Sorry, there are no images matching your search query. Please try again!`,\n      position: 'topRight',\n    });\n\n    refs.galleryList.innerHTML = '';\n    loaderHide(refs.searchLoader);\n    return;\n  }\n\n  refs.galleryList.innerHTML = renderGalleryMarkup(data.hits);\n\n  loaderHide(refs.searchLoader);\n  initSimpleLightBox();\n}\n\nfunction initSimpleLightBox() {\n  gallery = new SimpleLightbox('.gallery-list a', simplelightboxOptions);\n  gallery.refresh();\n}\n\nrefs.moreBtn.addEventListener('click', onMoreClick);\n\nasync function onMoreClick(e) {\n  if (page + 1 === totalPages) {\n    moreBtnHide();\n    iziToast.info({\n      message: \"We're sorry, but you've reached the end of search results.\",\n      position: 'topRight',\n    });\n  }\n\n  loaderShow(refs.moreLoader);\n  try {\n    page += 1;\n    gallery.destroy();\n    const data = await fetchPhotos(searchText);\n    const markup = renderGalleryMarkup(data.hits);\n    loaderHide(refs.moreLoader);\n    refs.galleryList.insertAdjacentHTML('beforeend', markup);\n    smoothScroll();\n    initSimpleLightBox();\n  } catch (err) {\n    loaderHide(refs.moreLoader);\n    console.log(err);\n  }\n}\n\nfunction smoothScroll() {\n  const galleryItem = document.querySelector('.gallery-item');\n\n  const galleryItemHeight = galleryItem.getBoundingClientRect().height;\n\n  window.scrollBy({\n    top: galleryItemHeight * 2, \n    behavior: 'smooth', \n  });\n}\n"],"names":["page","searchText","totalPages","gallery","refs","simplelightboxOptions","onSearch","e","loaderShow","data","fetchPhotos","createGallery","err","searchParams","axios","moreBtnShow","renderGalleryMarkup","photoList","photo","loaderHide","loader","moreBtnHide","iziToast","initSimpleLightBox","SimpleLightbox","onMoreClick","markup","smoothScroll","galleryItemHeight"],"mappings":"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"}